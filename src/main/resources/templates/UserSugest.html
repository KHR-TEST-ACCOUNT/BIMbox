<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
	<meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta th:name="_csrf" th:content="${_csrf.token}" />
	<meta th:name="_csrf_header" th:content="${_csrf.headerName}" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
	<link rel="stylesheet" th:href="@{/css/chatRoom.css}">
	<link rel="stylesheet" th:href="@{/css/layout.css}">
	<meta th:replace="fragments/Scripts :: scripts">
    <title>チャットルーム</title>
</head>
<body>
	<div class="cover"></div>
	<div th:replace="fragments/Sidenav :: sidenav"></div>
		<!-- 表示内容 -->
		<div class="main">
			<div th:replace="fragments/Header :: header"></div>
			<form th:object="${profileEditForm}">
				<div class="p-3">
					<!-- 検索条件 -->
					<div class="d-flex align-items-between">
						<h5 class="me-2">サジェストユーザー</h5>
						<a href="#" id="condition-toggler" data-bs-toggle="collapse" data-bs-target="#searchCondition">
							<span id="isShow" class="d-none">[表示]</span>
							<span id="isShow">[隠す]</span>
						</a>
					</div>
					<div id="searchCondition" class="collapse show">
						<p th:if="${profileEditForm.sujestUsers != null}">あなたと気の合いそうなユーザーです。</p>
						<div class="border p-3 rounded">
							<div class="d-flex align-items-top mb-2" th:each="user : ${profileEditForm.sujestUsers}" >
							
								<a th:href="|@{/profile/UserProfile.html}?id=${ user.key }|">
									<img class="toUserImg" th:src="${ user.value.profileImage.encodedString }" />
								</a>
								<a th:href="|@{/chatRoom.html}?id=${ user.key }|" class="text-decoration-none">
				                	<span th:text="${ user.value.name }"></span>
								</a>
							</div>
						</div>
					</div>
				</div>
			</form>
			<!-- 検索結果 -->
			<div class="pb-3 px-3">
				<form th:object="${conversationalUsers}">
					<div class="p-3">
						<!-- 検索条件 -->
						<div class="d-flex align-items-between">
							<h5 class="me-2">会話中のユーザー</h5>
						</div>
						<div class="d-flex align-items-top my-2 border p-3 rounded" th:each="chatUser : ${conversationalUsers}">
						
							<a th:href="|@{/profile/UserProfile.html}?id=${ chatUser.toUserId }|">
								<img class="toUserImg" th:src="${chatUser.toUserIcon.encodedString}" />
							</a>
							
							<a  th:href="|@{/chatRoom.html}?id=${chatUser.toUserId}|" class="text-decoration-none">
			                	<span th:text="${chatUser.toUser}"></span><br>
			                	<span th:text="${chatUser.content}"></span><br>
			                	<span th:text="${chatUser.AVF}"></span>
							</a>
							<!-- 
							<a  th:href="|@{/closed.html}?id=${chatUser.fromUserId}?id=${chatUser.toUserId}|"
							    class="text-decoration-none text-end">
								<small>非表示にする</small>
							</a>
							 -->
						</div>
						<div class="text-center mt-5">
							<p>他にメッセージを送りたい人がいたら検索画面からメッセージを送りましょう。</p>
							<a th:href="@{/manage/users/UserList.html}">　→　検索画面へ</a>
						</div>
					</div>
				</form>
			</div>
		</div>
	<div th:replace="fragments/Toast :: toast"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.4/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
<script src="/js/chatRoom.js"></script>
</body>
</html>